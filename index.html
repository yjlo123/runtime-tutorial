
<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>Runtime Script Tutorial</title>

	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<link rel="icon" href="https://siwei.dev/favicon.gif">

	<script src="https://runtime.siwei.dev/ui/main/jquery-1.12.4.js"></script>
	<script src="https://runtime.siwei.dev/ui/console/jqconsole.js"></script>

	<link rel="stylesheet" href="./css/styles.css">
	<link rel="stylesheet" href="https://runtime.siwei.dev/ui/console/jqconsole-embedded.css">
	<link rel="stylesheet" href="https://runtime.siwei.dev/ui/main/style.css"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
<div class="wrapper">
	<header>
		<h1 class="page-title">Runtime Script</h1>
		<p style="font-size:11px;color:gray;">Generated on 30 Dec, 2019</p>
		<p><em>by <a href="https://liusiwei.com" target="_blank">Siwei Liu</a></em></p>
		<p class="view">
			<a href="https://github.com/yjlo123/runtime-script" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a>
			<a href="https://runtime.siwei.dev" target="_blank"><i class="fa fa-flask" aria-hidden="true"></i></i></a>
		</p>
		<div class="toc" style="display: block;">
			<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#hello-world">Hello World</a></li>
<li><a href="#variables">Variables</a></li>
<li><a href="#data-types">Data Types</a></li>
<li><a href="#arithmetics">Arithmetics</a></li>
<li><a href="#jump">Jump</a></li>
<li><a href="#data-structures">Data Structures</a></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
<li><a href="#canvas">Canvas</a></li>
<li><a href="#advanced">Advanced</a></li>
			</ul>
		</div>
		<p class="side-title">Reference:</p>
		<pre>N: variable name
V: variable reference ($VR)
   or value (int|str|[]|{})
S: list or str $VR
M: map $VR
L: label
F: function $VR</pre>

	</header>

	<section>
<h2 id="introduction">Introduction</h2>
<p>Runtime Script is a tiny programming language I created for fun since early 2019.
Its syntax is assembly-like and greatly inspired by the game <a target="_blank" target="_blank" href="https://store.steampowered.com/app/504210/SHENZHEN_IO/">Shenzhen IO</a>.
Runtime Script is written in Javascript, so that it can be parsed and executed directly in the browser.</p>
<h2 id="hello-world">Hello World</h2>
<p>Just like any other programming languages, the first program we are going to try is outputing a <code>Hello World</code> message.</p>
<p>Click the <code>Run</code> button below to run the <code>Hello World</code> program.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 90px;">/ Welcome to Runtime Script
prt 'Hello World!'
</div>

<p>In the above embedded editor, you can write your program on the left and see the output of your program on the right after clicking the <code>Run</code> button.</p>
<p>To run the program one more time, just click the <code>Run</code> button again after the previous execution is finished.</p>
<p>To clear the console contents, you can click the console panel to focus on it, then type <code>clear</code> and press <code>Enter</code> key.</p>
<p>Let's get back to the program itself. The above <code>Hello World</code> program has just one line code, which has a keyword <code>prt</code> and a quoted string <code>'Hello World'</code></p>
<pre class="code-block"><code>prt 'Hello World!'
</code></pre>

<p>In Runtime Script, we call such a line of code a <code>statement</code>.
Each statement has an instruction keyword, like <code>prt</code> in this example, and an arbitrary number of arguments. All the keywords and arguments are separated by spaces.</p>
<p>The frist line in the above example is a comment, it is for your notation purpose and simply ignored by the execution. A comment starts with a slash (<code>/</code>), it can be after a statement with the same line or occupies the whole line.</p>
<h2 id="variables">Variables</h2>
<p>To declare a variable, we use the <code>let</code> keyword, followed by the variable name and its value.</p>
<pre class="code-block"><code>let N V
</code></pre>

<p>A dollar sign (<code>$</code>) should be prepended to the variable name when it is referenced.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 125px;">let x 5
prt $x
let x 'abc'
prt $x
</div>

<p>In the above example, we first create a new variable called <code>x</code> with an initial value of <code>5</code>, then print <code>x</code>. Now <code>x</code> is an integer.</p>
<p>Then we set a new value <code>'abc'</code>, which is a string, to the variable <code>x</code> and print it again.</p>
<h2 id="data-types">Data Types</h2>
<p>In Runtime Script, there are only two primitive data types, i.e. integer (<code>int</code>) and string (<code>str</code>). Besides, there are another two advanced data types, <code>list</code> and <code>map</code>, details about these two data types will be explained in the Data Structure section.</p>
<p>We can check a variable or value's data type by using the <code>typ</code> instruction.</p>
<pre class="code-block"><code>typ N V
</code></pre>

<p>Also, we can convert integers to strings or strings to integers, using <code>str</code> and <code>int</code> respectively.</p>
<pre class="code-block"><code>int N V
str N V
</code></pre>

<div class="runtime-embedded-box " style="width: 100%; height: 280px;">let x 5
let y '123'

typ t_x $x
prt $t_x

typ t_y $y
prt $t_y

/ convert y from string to integer
int iy $y
typ t_iy $iy
prt $t_iy
</div>

<h2 id="arithmetics">Arithmetics</h2>
<p>Runtime Script supports five basic arithmetic operations, namely addition (<code>add</code>), subtraction (<code>sub</code>), multiplication (<code>mul</code>), division (<code>div</code>), and modulo (<code>mod</code>).</p>
<pre class="code-block"><code>add N V V
sub N V V
mul N V V
div N V V
mod N V V
</code></pre>

<p>Let's take addition as an example, the sum of the two values <code>V V</code> is assigned to the variable <code>N</code>, the variable <code>N</code> will be created if it has not been defined.</p>
<p>The <code>div</code> instruction works as a floor division, thus the division result is always an integer.</p>
<p>Play around with the following examples to get familiar with these arithmetic operations.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 350px;">let x 5
let y 2

add z $x $y
prt $z

sub z $x $y
prt $z

mul z $x $y
prt $z

div z $x $y
prt $z

mod z $x $y
prt $z
</div>

<p>Moreover, the arguments can be strings for the following cases:<br />
1. <code>add</code> two strings to concatenate them<br />
2. <code>add</code> a string/integer to an integer/string to concatenate them<br />
3. <code>mul</code> a string by an integer to repeate the string a number of times  </p>
<div class="runtime-embedded-box " style="width: 100%; height: 190px;">add z 'Hello' 'World'
prt $z

add z 'abc' 5
prt $z

mul z 'Hi' 3
prt $z
</div>

<h2 id="jump">Jump</h2>
<p>In Runtime Script, you can insert labels to any places in your program, and jump to a specifc lable using the <code>jmp</code> instruction.</p>
<pre class="code-block"><code>jmp L
</code></pre>

<p>A label is a line starts with a hashtag <code>#</code>.</p>
<p>In the following example, the line <code>prt 'skipped'</code> is skipped because of jumping to the "continue" label.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 140px;">prt 'start'
jmp continue
prt 'skipped'
#continue
prt 'end'
</div>

<p>There are four other jump instructions which only jump when a certain condition is true.</p>
<ol>
<li><code>jeq</code>: jump if equal  </li>
<li><code>jne</code>: jump if not equal  </li>
<li><code>jlt</code>: jump if less than  </li>
<li><code>jgt</code>: jump if greater than  </li>
</ol>
<pre class="code-block"><code>jeq V V L
jne V V L
jlt V V L
jgt V V L
</code></pre>

<div class="runtime-embedded-box " style="width: 100%; height: 150px;">let i 0
#loop
prt $i
add i $i 1
jne $i 5 loop
</div>

<p>The above example demonstrates printing and incrementing <code>i</code> from 0 to 4.</p>
<h2 id="data-structures">Data Structures</h2>
<p>Two data structures are provided in Runtime Script, i.e. <code>list</code> and <code>map</code>, and they are used as containers.</p>
<h3>List</h3>
<p>The literal <code>[]</code> represents an empty list. Usually it is used when defining a new list.</p>
<blockquote>
<p>Defining a non-empty list is not supported.</p>
</blockquote>
<p>There are three instructions for list operations:</p>
<pre class="code-block"><code>psh S V
pop S N
pol S N
</code></pre>

<p><code>psh</code> for appending a value to the end to the list, <code>pop</code> for extracting the last item from the list, and <code>pol</code> for extracting the first item from the list.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 320px;">let list []
psh $list 3
psh $list 2
psh $list 'a'
prt $list

/ pop the last item
pop $list i
prt $i

/ poll the first item
pol $list j
prt $j

prt $list
</div>

<blockquote>
<p><code>pop</code> or <code>pol</code> from an empty list will result in a <code>$nil</code>, which represents an empty value.</p>
</blockquote>
<p>List instructions also work on strings. We can regard a string as a list and each character is an item in this list.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 200px;">let str 'abcz'

pop $str i
prt $i

psh $str 'd'
psh $str 'ef'
prt $str
</div>

<blockquote>
<p><code>pop</code> or <code>pol</code> from an empty stirng will result in an empty string (<code>''</code>).</p>
</blockquote>
<h3>Map</h3>
<p>The literal <code>{}</code> represents an empty map.</p>
<p>There are two instructions, <code>put</code> and <code>get</code>, for adding a key-value pair and getting the value by its key respectively.</p>
<pre class="code-block"><code>put M V V
get M V N
</code></pre>

<p>The keys are always strings, and the values can be any date types.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 300px;">let map {}

put $map 0 'Zero'
put $map 1 'One'
put $map 3 'Three'

let lst []
psh $lst 123

put $map list $lst

prt $map
get $map 3 val
prt $val
</div>

<p>If you put a key-value pair where the key already exists in the map, the old value will be replaced with the new one.</p>
<p>If the key in the <code>get</code> statement does not present in the map, a <code>$nil</code> value will be returned.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 190px;">let map {}

put $map 0 'zero'
put $map 1 'true'

put $map 0 'false'

prt $map
</div>

<h2 id="miscellaneous">Miscellaneous</h2>
<h3>User input</h3>
<p>Get a user input string from the console.</p>
<pre class="code-block"><code>inp N
</code></pre>

<div class="runtime-embedded-box " style="width: 100%; height: 110px;">prt 'Enter your value:'
inp i
prt $i
</div>

<h3>Sleep</h3>
<p>Pause the program for a certain number of milliseconds.</p>
<pre class="code-block"><code>slp V
</code></pre>

<div class="runtime-embedded-box " style="width: 100%; height: 110px;">prt 'Hello'
slp 1000
prt 'Bye'
</div>

<p>In the above example, the program is paused for one second before printing the 'Bye' message.</p>
<p>In the following example, we are going to "slow-print" the hello wolrd message.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 230px;">let msg 'Hello, wrold!'

#next
pol $msg c
jeq $c '' done
slp 100
prt $c ''
jmp next
#done
prt ''
</div>

<h3>Random</h3>
<p>Get a random integer between two integers, where the ending integer is not included.</p>
<pre class="code-block"><code>rnd N V V
</code></pre>

<div class="runtime-embedded-box " style="width: 100%; height: 110px;">/ Get a random integer among 1, 2, 3, 4
rnd num 1 5
prt $num
</div>

<h3>Time</h3>
<p>Get the system date or time.</p>
<pre class="code-block"><code>tim N year|month|date|day|hour|minute|second|milli
</code></pre>

<div class="runtime-embedded-box " style="width: 100%; height: 90px;">tim y year
prt $y
</div>

<h3>User Key Press</h3>
<p>There is a special value, <code>$lastkey</code>, which records the user's last pressed key code.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 300px;">prt 'Press an arrow key'
#start
let key $lastkey
slp 200
jeq $key -1 start

let key_map {}
put $key_map 37 'Left'
put $key_map 38 'Up'
put $key_map 39 'Right'
put $key_map 40 'Down'

get $key_map $key direction
prt $direction
</div>

<p>You can check a specific key's code <a target="_blank" target="_blank" href="https://keycode.info/">here</a>.</p>
<h2 id="canvas">Canvas</h2>
<pre class="code-block"><code>clr
drw V V V
pxl N V V
</code></pre>

<div class="runtime-embedded-box runtime-show-canvas" style="width: 100%; height: 250px;">clr
let x 9
#draw_dot
slp 200
drw $x 11 1
add x $x 2
jne $x 15 draw_dot
prt 'Hello World!'
</div>

<h2 id="advanced">Advanced</h2>
<p>Runtime Script also has some advanced instructions to mimic some high-level programming language statements, such as if-else and functions. These instructions can make it more convenient to write programs, but we should use them with cautions.</p>
<blockquote>
<p>Indentations in Runtime Script are only for readability, they have no effect on the execution.</p>
</blockquote>
<h3>If-else</h3>
<p>Executing certain lines of statements depends on the comparison result of two values.</p>
<pre class="code-block"><code>ife V V
ifg V V
els
fin
</code></pre>

<ol>
<li><code>ife</code>: if the two values are equal</li>
<li><code>ifg</code>: if the first value is greater than the second value</li>
<li><code>els</code>: else (optional)</li>
<li><code>fin</code>: end of if-else</li>
</ol>
<blockquote>
<p>Nested if-else is not supported.</p>
</blockquote>
<p>If-else is a convenient way to write condition checks, it may save your time writing complicated codes with jumps and labels.</p>
<p>The following program checking the equality of two numbers by using if-else</p>
<div class="runtime-embedded-box " style="width: 100%; height: 180px;">let a 0
let b 1
ife $a $b
 prt 'equal'
els
 prt 'not equal'
fin
</div>

<p>is equivalent to</p>
<div class="runtime-embedded-box " style="width: 100%; height: 200px;">let a 0
let b 1
jne $a $b not_equal
prt 'equal'
jmp end_check
#not_equal
prt 'not equal'
#end_check
</div>

<h3>Function</h3>
<p>Define a block of statements for code reuse.</p>
<pre class="code-block"><code>def N
ret
end
cal F
</code></pre>

<ol>
<li><code>def</code>: the head of a function definition with the function name</li>
<li><code>ret</code>: jump to the line after the previous function call</li>
<li><code>end</code>: the end of the function definition, jump to the line after the previous function call</li>
<li><code>cal</code>: jump to the function head by name</li>
</ol>
<blockquote>
<p>Do not exit a function using jump statements.</p>
</blockquote>
<p>A 'random' function is defined in the folling program, and it is called twice. </p>
<div class="runtime-embedded-box " style="width: 100%; height: 190px;">def random
 prt 'Your random number:'
 rnd n 1 10
 prt $n
end

cal random
cal random
</div>

<p>The following program demonstrates the recursion version of calculating factorials.</p>
<div class="runtime-embedded-box " style="width: 100%; height: 470px;">def factorial
 pop $s n
 ife $n 1       / base case
  psh $s $n
  ret           / return to last func call
 fin
 psh $s $n
 sub n1 $n 1    / decrease param by 1
 psh $s $n1     / param for recursion call

 cal factorial  / recursion call

 pop $s n3
 pop $s n4      / pop 2 nums from stack
 mul n5 $n3 $n4 / get their product
 psh $s $n5     / push back to stack
end

let num 5
let s []        / a temp param stack
psh $s $num
cal factorial   / initial func call
pop $s res      / only 1 num left in stack
prt $res
</div>
	</section>

	<footer>
	</footer>
	</div>

<script src="https://runtime.siwei.dev/runtime-init.js"></script>
<script src="https://runtime.siwei.dev/ui/editor/ace.js"></script>
<script src="https://runtime.siwei.dev/src/parser.js"></script>
<script src="https://runtime.siwei.dev/src/canvas.js"></script>
<script src="https://runtime.siwei.dev/src/evaluator.js"></script>
<script src="https://runtime.siwei.dev/src/executer.js"></script>
<script src="https://runtime.siwei.dev/runtime.js"></script>

<style>
	.ace-chrome .ace_gutter {
		background: white;
		border-right: 1px solid #ddd;
	}
	
	.runtime-embedded-box {
		margin-bottom: 15px;
	}
</style>

<script>
function highlightToc() {
	let currentPos = $(document).scrollTop();
	let tocItems = $(".toc ul").find('li');
	tocItems.removeClass("current");
	$("h2").each(function( index ) {
		let idx = index > 0 ? index-1 : 0;
		let el = $(".toc ul").find('li').eq(idx);
		if ($(this).offset().top - 100 > currentPos) {
			el.addClass("current");
			return false;
		}
		if (index === tocItems.length - 1) {
			$(".toc ul").find('li').eq(tocItems.length - 1).addClass("current");
		}
	});
}
$(document).ready(highlightToc);
$(window).scroll(highlightToc);
</script>

</body>
</html>